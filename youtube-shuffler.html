<!--

*** Disclaimer ***

I wrote this using ChatGPT because I needed such a tool. While it functions,I
have not verified the code quality or thoroughly tested for edge cases, etc.

-->
<!DOCTYPE html>
<html>
<head>
    <title>YouTube Video Player</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        body {
            max-width: 100%;
            overflow-x: hidden;
        }

        textarea {
            width: 100%;
        }
    </style>
</head>
<body>
    <div>
        <label for="videoInput">Enter Video IDs (Format: id,start,end):</label><br>
        <textarea id="videoInput" rows="5"></textarea><br>
        <label for="playMode">Play Mode:</label>
        <select id="playMode">
            <option value="random">Random</option>
            <option value="randomNoRepeat">Random (No Repeats)</option>
            <option value="sequential">Sequential</option>
            <option value="repeat">Repeat</option>
        </select><br>
        <button id="startButton">Start</button>
    </div>

    <div id="player"></div>

    <script src="https://www.youtube.com/iframe_api"></script>
    <script>
        let player;
        let videoQueue = [];
        let currentIndex = 0;
        let lastIndex = -1;

        function onYouTubeIframeAPIReady() {
            player = new YT.Player('player', {
                height: '320px',
                width: '100%',
                events: {
                    'onReady': onPlayerReady,
                    'onStateChange': onPlayerStateChange
                }
            });
        }

        function onPlayerReady(event) {
            const anchor = window.location.hash.slice(1);
            if (anchor) {
                const decoded = decodeURIComponent(anchor);
                document.getElementById('videoInput').value = decoded;
                initializeVideoQueue(decoded);
                playNextVideo();
            }

            document.getElementById('startButton').addEventListener('click', () => {
                const videoInput = document.getElementById('videoInput').value;
                initializeVideoQueue(videoInput);
                playNextVideo();
                window.location.hash = encodeURIComponent(videoInput);
            });
        }

        function initializeVideoQueue(videoInput) {
            videoQueue = videoInput.split('\n').map(line => {
                const [id, start, end] = line.split(',');
                return { id, start, end };
            });
        }

        function onPlayerStateChange(event) {
            if (event.data === YT.PlayerState.ENDED) {
                if (document.getElementById('playMode').value === 'repeat') {
                    playVideo(videoQueue[currentIndex]);
                } else {
                    playNextVideo();
                }
            }
        }

        function playNextVideo() {
            lastIndex = currentIndex;
            const playMode = document.getElementById('playMode').value;
            if (playMode === 'random') {
                currentIndex = Math.floor(Math.random() * videoQueue.length);
            } else if (playMode === 'randomNoRepeat') {
                let newIndex;
                do {
                    newIndex = Math.floor(Math.random() * videoQueue.length);
                } while (newIndex === lastIndex && videoQueue.length > 1);
                currentIndex = newIndex;
            } else {
                currentIndex = (currentIndex + 1) % videoQueue.length;
            }
            playVideo(videoQueue[currentIndex]);
        }

        function playVideo({ id, start, end }) {
            player.loadVideoById({ videoId: id, startSeconds: start, endSeconds: end });
        }
    </script>
</body>
</html>

